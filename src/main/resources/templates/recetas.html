<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Plataforma de Recetas Saludables y Económicas</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
<!-- Header -->
    <div th:replace="~{fragmentos :: header}"></div>

    <!-- ================= MAIN ================= -->
    <main>
            <section class="container my-4">
                <div class="d-flex align-items-center mb-3">
                    <h2 class="mb-0">Todas las recetas</h2>
                    <span class="ms-3 text-muted" id="recipes-count"></span>
                </div>
                <div id="recipes-grid" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4"></div>
                <p id="recipes-empty" class="text-muted mt-3" style="display:none">No hay recetas para mostrar.</p>
            </section>
    </main>
    <!-- Footer -->
    <div th:replace="~{fragmentos :: footer}"></div>
    <!-- Scripts -->
    <div th:replace="~{fragmentos :: scripts}"></div>

        <script>
            const API_RECIPES = '/api/recetas';

            document.addEventListener('DOMContentLoaded', () => {
                loadAllRecipes();
            });

            async function loadAllRecipes() {
                const grid = document.getElementById('recipes-grid');
                const empty = document.getElementById('recipes-empty');
                const countEl = document.getElementById('recipes-count');
                grid.innerHTML = '';
                empty.style.display = 'none';

                try {
                    const res = await fetch(API_RECIPES);
                    if (!res.ok) throw new Error('No se pudo cargar recetas');
                    const recipes = await res.json();
                    countEl.textContent = recipes?.length ? `${recipes.length} recetas` : '';

                    if (!recipes || recipes.length === 0) {
                        empty.style.display = 'block';
                        return;
                    }

                    recipes.forEach(r => {
                        const col = document.createElement('div');
                        col.className = 'col';

                        const card = document.createElement('div');
                        card.className = 'card h-100 shadow-sm';
                        card.style.cursor = 'pointer';
                        card.addEventListener('click', () => {
                            if (r.id) window.location.href = `/vista/${r.id}`;
                        });

                        const img = document.createElement('img');
                        img.className = 'card-img-top';
                        img.style.height = '220px';
                        img.style.objectFit = 'cover';
                        img.src = r.imagenUrl || '/assets/recetas/default.jpg';
                        img.alt = r.nombre || '';

                        const body = document.createElement('div');
                        body.className = 'card-body';

                        const title = document.createElement('h5');
                        title.className = 'card-title';
                        title.textContent = r.nombre || '';

                        // Metadatos: tiempo y dificultad con íconos
                        const meta = document.createElement('div');
                        meta.className = 'd-flex gap-2 mb-2';
                        const tiempo = document.createElement('span');
                        tiempo.className = 'badge text-bg-light';
                        tiempo.innerHTML = `<i class="bi bi-clock me-1"></i>${r.tiempoPreparacion ?? '—'} min`;
                        const dificultad = document.createElement('span');
                        dificultad.className = 'badge text-bg-light';
                        dificultad.innerHTML = `<i class="bi bi-speedometer2 me-1"></i>${r.dificultad ?? '—'}`;

                        const price = document.createElement('div');
                        price.className = 'mb-2';
                        price.innerHTML = `<span class="badge bg-success">Precio: S/ ${r.precio ?? '—'}</span>`;

                        const ingList = document.createElement('p');
                        ingList.className = 'card-text text-muted';
                        const ingredientes = (r.ingredientes || []).slice(0, 4).map(i => i.nombre).join(', ');
                        ingList.textContent = ingredientes ? `Ingredientes: ${ingredientes}` : 'Ingredientes: —';

                        body.appendChild(title);
                        body.appendChild(meta);
                        meta.appendChild(tiempo);
                        meta.appendChild(dificultad);
                        body.appendChild(price);
                        body.appendChild(ingList);

                        card.appendChild(img);
                        card.appendChild(body);
                        col.appendChild(card);
                        grid.appendChild(col);
                    });
                } catch (err) {
                    console.error(err);
                    empty.style.display = 'block';
                    empty.textContent = 'Error al cargar las recetas.';
                }
            }
        </script>

</body>

</html>
