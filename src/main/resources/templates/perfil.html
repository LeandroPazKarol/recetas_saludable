<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil de Usuario</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
<!-- Header -->
<div th:replace="~{fragmentos :: header}"></div>

<!-- Alertas -->
<div th:if="${param.updated}" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle me-2"></i>Perfil actualizado correctamente
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<div th:if="${param['password-changed']}" class="alert alert-success alert-dismissible fade show">
    <i class="bi bi-check-circle me-2"></i>Contraseña cambiada correctamente
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>

<!-- Perfil de Usuario -->
<main class="container my-5">
    <div class="row g-4">

        <!-- Tarjeta de Perfil -->
        <div class="col-md-4">
            <div class="card shadow-sm text-center p-3 profile-card">
                <img th:src="@{/assets/usuario1.png}"
                     class="mx-auto mb-3"
                     style="width:120px; height:120px; border-radius:50%; object-fit:cover;"
                     alt="Foto de perfil">

                <h4 class="fw-bold mb-1" th:text="${usuario.nombre + ' ' + usuario.apellido}">
                    Nombre Usuario
                </h4>
                <p class="text-muted mb-2" th:text="${usuario.correo}">
                    correo@ejemplo.com
                </p>
                <p class="text-muted mb-2">
                    <i class="bi bi-geo-alt-fill"></i>
                    <span th:text="${usuario.pais}">País</span>
                </p>

                <span class="badge bg-success mb-3">Usuario Activo</span>

                <div>
                    <a href="#" class="btn btn-primary btn-sm w-100 mb-2"
                       data-bs-toggle="modal" data-bs-target="#editarPerfilModal">
                        <i class="bi bi-pencil-square me-1"></i>Editar perfil
                    </a>
                </div>
            </div>
        </div>

        <!-- Contenido del Perfil -->
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <!-- Tabs -->
                    <ul class="nav nav-tabs mb-3" id="perfilTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="info-tab" data-bs-toggle="tab"
                                    data-bs-target="#info" type="button" role="tab">
                                Información
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="Publicaciones-tab" data-bs-toggle="tab"
                                    data-bs-target="#publicaciones" type="button" role="tab">
                                Publicaciones
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="favoritos-tab" data-bs-toggle="tab"
                                    data-bs-target="#favoritos" type="button" role="tab">
                                Favoritos
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="perfilTabsContent">

                        <!-- Información Personal -->
                        <div class="tab-pane fade show active" id="info" role="tabpanel">
                            <h5 class="mb-3">Datos personales</h5>
                            <dl class="row">
                                <dt class="col-sm-4">Nombre completo</dt>
                                <dd class="col-sm-8" th:text="${usuario.nombre + ' ' + usuario.apellido}">
                                    Nombre Apellido
                                </dd>

                                <dt class="col-sm-4">Correo electrónico</dt>
                                <dd class="col-sm-8" th:text="${usuario.correo}">
                                    correo@ejemplo.com
                                </dd>

                                <dt class="col-sm-4">Teléfono</dt>
                                <dd class="col-sm-8" th:text="${usuario.telefono ?: 'No especificado'}">
                                    No especificado
                                </dd>

                                <dt class="col-sm-4">País</dt>
                                <dd class="col-sm-8" th:text="${usuario.pais}">
                                    País
                                </dd>

                                <dt class="col-sm-4">Miembro desde</dt>
                                <dd class="col-sm-8">
                                    Diciembre 2025
                                </dd>
                            </dl>

                            <div class="mt-4">
                                <button class="btn btn-outline-primary btn-sm me-2"
                                        data-bs-toggle="modal" data-bs-target="#editarPerfilModal">
                                    <i class="bi bi-pencil me-1"></i>Editar información
                                </button>
                                <button class="btn btn-outline-secondary btn-sm"
                                        data-bs-toggle="modal" data-bs-target="#cambiarContrasenaModal">
                                    <i class="bi bi-key me-1"></i>Cambiar contraseña
                                </button>
                            </div>
                        </div>

                        <!-- Recetas Publicadas -->
                        <div class="tab-pane fade" id="publicaciones" role="tabpanel">
                            <h5 class="mb-3">Mis recetas</h5>
                            <div class="row g-3">
                                <div class="col-12 text-center text-muted py-5">
                                    <i class="bi bi-bookmark display-1 mb-3"></i>
                                    <p>Aún no has publicado ninguna receta</p>
                                    <a th:href="@{/recetas}" class="btn btn-success">
                                        Explorar Recetas
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Favoritos -->
                        <div class="tab-pane fade" id="favoritos" role="tabpanel">
                            <h5 class="mb-3">Recetas Favoritas</h5>
                            <div class="row g-3">
                                <div class="col-12 text-center text-muted py-5">
                                    <i class="bi bi-heart display-1 mb-3"></i>
                                    <p>Aún no tienes recetas favoritas</p>
                                    <a th:href="@{/recetas}" class="btn btn-success">
                                        Descubrir Recetas
                                    </a>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Modal: Editar Perfil -->
<div class="modal fade" id="editarPerfilModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar Perfil</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/usuario/actualizar}" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" name="nombre"
                               th:value="${usuario.nombre}" required>
                    </div>

                    <div class="mb-3">
                        <label for="apellido" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="apellido" name="apellido"
                               th:value="${usuario.apellido}" required>
                    </div>

                    <div class="mb-3">
                        <label for="telefono" class="form-label">Teléfono</label>
                        <input type="tel" class="form-control" id="telefono" name="telefono"
                               th:value="${usuario.telefono}">
                    </div>

                    <div class="mb-3">
                        <label for="pais" class="form-label">País</label>
                        <select class="form-select" id="pais" name="pais" required>
                            <option th:selected="${usuario.pais == 'Perú'}" value="Perú">Perú</option>
                            <option th:selected="${usuario.pais == 'Argentina'}" value="Argentina">Argentina</option>
                            <option th:selected="${usuario.pais == 'Chile'}" value="Chile">Chile</option>
                            <option th:selected="${usuario.pais == 'Colombia'}" value="Colombia">Colombia</option>
                            <option th:selected="${usuario.pais == 'México'}" value="México">México</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Guardar cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Cambiar Contraseña -->
<div class="modal fade" id="cambiarContrasenaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cambiar Contraseña</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/usuario/cambiar-contrasena}" method="post">
                <div class="modal-body">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div class="mb-3">
                        <label for="contrasenaActual" class="form-label">Contraseña actual</label>
                        <input type="password" class="form-control" id="contrasenaActual"
                               name="contrasenaActual" required>
                    </div>

                    <div class="mb-3">
                        <label for="contrasenaNueva" class="form-label">Nueva contraseña</label>
                        <input type="password" class="form-control" id="contrasenaNueva"
                               name="contrasenaNueva" required minlength="8">
                        <small class="text-muted">Mínimo 8 caracteres</small>
                    </div>

                    <div class="mb-3">
                        <label for="confirmarContrasena" class="form-label">Confirmar nueva contraseña</label>
                        <input type="password" class="form-control" id="confirmarContrasena"
                               name="confirmarContrasena" required minlength="8">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Cambiar contraseña
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Footer -->
<div th:replace="~{fragmentos :: footer}"></div>
<!-- Scripts -->
<div th:replace="~{fragmentos :: scripts}"></div>

<!-- Script para validar contraseñas -->
<script>
    document.querySelector('#cambiarContrasenaModal form').addEventListener('submit', function(e) {
        const nueva = document.getElementById('contrasenaNueva').value;
        const confirmar = document.getElementById('confirmarContrasena').value;

        if (nueva !== confirmar) {
            e.preventDefault();
            alert('Las contraseñas no coinciden');
        }
    });
</script>

</body>

</html>